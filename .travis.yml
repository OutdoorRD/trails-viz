language: python
git:
  depth: 5
services:
  - docker
python:
  - 3.6
branches:
  only:
    - master
before_install:
  - node_js install 10

install:
  - python -m pip install --upgrade pip
  - pip install flake8
  - pip install wheel

jobs:
  include:
    - stage: app-build
      script:
        - cd trails-viz-app
        - npm install
        - npn run lint
        - npm run build
        - cd ..
    - stage: api-build
      script:
        - cd trails-viz-api
        - pip install -r requirements.txt
        - flake8 . --count --max-line-length=119 --exclude trailsvizapi/__init__.py --show-source --statistics
        - python setup.py bdist_wheel
        - cd ..

stages:
  - app-build
  - api-build
